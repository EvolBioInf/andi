language: cpp
compiler:
- gcc
before_install:
- sudo pip install cpp-coveralls
- sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
- sudo apt-get update -qq
- if [ "$CXX" = "g++" ]; then sudo apt-get install -qq g++-4.8; fi
- if [ "$CXX" = "g++" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi
- sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 90
- sudo apt-get install libglib2.0-dev libgsl0-dev
- wget https://github.com/y-256/libdivsufsort/archive/master.tar.gz
- tar -xzvf master.tar.gz
- cd libdivsufsort-master
- mkdir build
- cd build
- cmake -DCMAKE_BUILD_TYPE="Release" -DCMAKE_INSTALL_PREFIX="/usr/local" ..
- make
- sudo make install
- cd $TRAVIS_BUILD_DIR
- export LD_LIBRARY_PATH=/usr/local:$LD_LIBRARY_PATH
script:
- export LD_LIBRARY_PATH=/usr/local/lib:/usr/local:$LD_LIBRARY_PATH
- export OMP_NUM_THREADS=4
- autoreconf -fvi -Im4
- ./configure --enable-unit-tests CFLAGS='-fprofile-arcs -ftest-coverage' CXXFLAGS='-fprofile-arcs -ftest-coverage' --without-zsh-completion-dir
- make
- make check
- make distcheck
- tar xzvf andi-*.tar.gz
- cd andi-*
- ./configure --enable-unit-tests --without-libdivsufsort --without-zsh-completion-dir
- make
- make check
- cd ..
after_success:
- coveralls --exclude libdivsufsort-master -E '^andi-.*' --exclude libs --exclude test --gcov `which gcov-4.8` --gcov-options '\-lp'
